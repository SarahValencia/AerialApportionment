<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ArealApportionment">
<title>Using Areal Apportionment to Assess Community Composition Near TRI Facilities: Long Island • ArealApportionment</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using Areal Apportionment to Assess Community Composition Near TRI Facilities: Long Island">
<meta property="og:description" content="ArealApportionment">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ArealApportionment</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/LI_Facilities_Example.html">Using Areal Apportionment to Assess Community Composition Near TRI Facilities: Long Island</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Using Areal Apportionment to Assess Community Composition Near TRI Facilities: Long Island</h1>
            
      
      
      <div class="d-none name"><code>LI_Facilities_Example.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sarahvalencia.github.io/ArealApportionment/" class="external-link">ArealApportionment</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT" class="external-link">DT</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="obtaining-census-data">Obtaining Census Data<a class="anchor" aria-label="anchor" href="#obtaining-census-data"></a>
</h2>
<p>Say we want to look at the community characteristics in areas near
TRI reporting facilities on Long Island. To do this we need to obtain
demographic data at the block group level. We can do using the
GetCensusData function. We need to determine the spatial scale and time
frame of the census data we need. We decide we are interested in the
most recent 5 year American Community Survey dataset (ending in 2021) at
the “block group” geography for the four counties on Long Island, and
that we would like the data projected from the NAD83 coordinate system
(lat/lon in degrees) to the WSG84 coordinate system in meters
(EPSG=4269).</p>
<p>First we need to load the tidycensus package set our Census API key.
You can obtain a census_api_key <a href="https://api.census.gov/data/key_signup.html" class="external-link">here</a> and then use
the census_api_key() function to establish a connection.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a></span><span class="op">)</span></span>
<span><span class="co">#census_api_key("paste your census API key here", install=TRUE)</span></span></code></pre></div>
<p>Then we create a vector of county names</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LICounties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kings"</span>, <span class="st">"Queens"</span>, <span class="st">"Nassau"</span>,<span class="st">"Suffolk"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we need to determine which variables we are interested in.
The tidycensus package includes the function load_variables, but the ACS
collects information on thousands of different variables, and the
variable codes are not consistent from survey to survey.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ACSVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/load_variables.html" class="external-link">load_variables</a></span><span class="op">(</span>year<span class="op">=</span><span class="fl">2021</span>,dataset <span class="op">=</span> <span class="st">"acs5"</span>,cache<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ACSVars</span><span class="op">)</span></span></code></pre></div>
<p>For this reason, it is helpful to use the CensusVariableSearch
function to look up specific variable codes. We are interested in the
racial make up of communities near TRI facilities, as well as their
median income.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RaceVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CensusVariableSearch.html">CensusVariableSearch</a></span><span class="op">(</span>Yr<span class="op">=</span><span class="fl">2021</span>, dataset<span class="op">=</span><span class="st">"acs5"</span>, variableCode <span class="op">=</span> <span class="cn">NULL</span>, geog_var <span class="op">=</span> <span class="st">"block group"</span>, conceptSearch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"race"</span><span class="op">)</span>,labelSearch <span class="op">=</span> <span class="st">"Estimate!!Total:"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">IncomeVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CensusVariableSearch.html">CensusVariableSearch</a></span><span class="op">(</span>Yr<span class="op">=</span><span class="fl">2021</span>, dataset<span class="op">=</span><span class="st">"acs5"</span>, variableCode <span class="op">=</span> <span class="cn">NULL</span>, geog_var <span class="op">=</span> <span class="st">"block group"</span>, conceptSearch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median income"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This search yields no results, so we try again with just income as a
search term.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IncomeVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CensusVariableSearch.html">CensusVariableSearch</a></span><span class="op">(</span>Yr<span class="op">=</span><span class="fl">2021</span>, dataset<span class="op">=</span><span class="st">"acs5"</span>, variableCode <span class="op">=</span> <span class="cn">NULL</span>, geog_var <span class="op">=</span> <span class="st">"block group"</span>, conceptSearch  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now we get 450 variables, but by scrolling through we can see that
the term we are looking for is median household income. So we try again
with this term (and note that capitalization doesn’t matter, but this is
just copied and pasted from the table).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IncomeVars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CensusVariableSearch.html">CensusVariableSearch</a></span><span class="op">(</span>Yr<span class="op">=</span><span class="fl">2021</span>, dataset<span class="op">=</span><span class="st">"acs5"</span>, variableCode <span class="op">=</span> <span class="cn">NULL</span>, geog_var <span class="op">=</span> <span class="st">"block group"</span>, conceptSearch  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MEDIAN HOUSEHOLD INCOME"</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
<p>We get a much narrower set of variables, and scrolling through see
that code B19013_001 corresponds with the median household income that
is not broken down by age.</p>
<p>After running this function multiple times we can assembled a list of
variables we would like to track, namely, the number of people of each
race/ethnicity and the median household income. In the PullCensusData
function we can either call census variables directly by their codes, or
we can create a named vector of variable names so that the headings that
appear in the table are more informative to the user.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  total_race <span class="op">=</span> <span class="st">"B02001_001"</span>,</span>
<span>  white_alone <span class="op">=</span> <span class="st">"B02001_002"</span>,     </span>
<span>  black_alone <span class="op">=</span> <span class="st">"B02001_003"</span>,</span>
<span>  Amer_indian <span class="op">=</span> <span class="st">"B02001_004"</span>,</span>
<span>  Asian <span class="op">=</span> <span class="st">"B02001_005"</span>,</span>
<span>  Pacific_islander <span class="op">=</span> <span class="st">"B02001_006"</span>,</span>
<span>  Other_race <span class="op">=</span> <span class="st">"B02001_007"</span>,</span>
<span>  Two_or_more_races <span class="op">=</span> <span class="st">"B02001_008"</span>,</span>
<span>  hispanic_pop <span class="op">=</span> <span class="st">"B03003_003"</span>,</span>
<span>  median_income <span class="op">=</span> <span class="st">"B19013_001"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We are now ready to run the function and get the ACS data</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">CensusLI_bg</span><span class="op">)</span></span></code></pre></div>
<p>We now have counts by race, total population counts, and the median
income for all the block groups in these 4 counties, as well as the
geometry of the block group polygons which have been projected into the
metric coordinate system WGS 84. The getACS function produces estimates
(column name with the suffix E) and measures of error (column names with
the suffix M).</p>
<p>We also want to pull county level data for Long Island for
comparison. This can help us understand if the communities near TRI
facilities have different demographic makeups from the county has a
whole. Note that you can also use census tract level data for
comparison.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Census_county_NY</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="downloading-risk-screening-environmental-indicators-rsei-data">Downloading Risk Screening Environmental Indicators (RSEI) Data<a class="anchor" aria-label="anchor" href="#downloading-risk-screening-environmental-indicators-rsei-data"></a>
</h2>
<p>Next we want to obtain the locations of facilities reporting
emissions under the Toxic Release Inventory (TRI) program that are in
the 4 counties we described, as well as the types of chemicals released
and their hazard scores. We can get these from the publicly available
RSEI data. There are two ways to access these data. First, we would like
to store the data locally for future use since the download can be time
consuming, so we will use the GetRSEI function to download and store the
most recent data to the folder of our choosing. This can be done with
the following code:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myworkingdirectory</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">DataList</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GetRSEIData.html">GetRSEIData</a></span><span class="op">(</span>rseiversion <span class="op">=</span> <span class="st">"v2311"</span>, savetodisk <span class="op">=</span> <span class="cn">T</span>, directory <span class="op">=</span> <span class="va">myworkingdirectory</span>, seconds<span class="op">=</span><span class="fl">500</span><span class="op">)</span></span></code></pre></div>
<p>5 RSEI tables are returned in this list: 1. Facility - contains
information about each facility that is part of the TRI program. 2.
Chemicals - a list of all chemicals tracked in the TRI program. 3.
Submissions - contains Form R information submitted to TRI, including
the year of the submission. 4. Elements - contains the calculated
results for each release. There can be multiple elements records for
each release. 5. Releases - contains data for each chemical release.
There can be multiple release records per submission record.</p>
<p>Note that in the above code, the 5 RSEI tables downloaded are
returned in a list and assigned to the global environment, and also
saved to the directory provided if savetodisk is TRUE. This allows users
to then access the files locally for future operations. If the download
times out before it is completed, the seconds argument can be extended
to provide more time for a slow download.</p>
</div>
<div class="section level2">
<h2 id="searching-the-rsei-database">Searching the RSEI Database<a class="anchor" aria-label="anchor" href="#searching-the-rsei-database"></a>
</h2>
<p>Users can then search the RSEI files to obtain data on the chemical
releases per facility per year using the RSEISearchFunction. If data is
stored locally, the RSEISearchFunction can access those files provided
they have been saved with the same names they were downloaded with.
Alternatively, it is possible to download the data directly as part of
the RSEISearchFunction by selecting DownloadRSEI = TRUE and choosing
which version of data to obtain (“v2311” or “v2310”).</p>
<p>The RSEISearchFunction is very flexible, with lots of optional
arguments to allows users to narrow in on data from the location, time
period, industry sector, or facilities they are interested in. Here, we
are interested in facilities in the 5 years between 2017 and 2021 (the
most recent year of data), in the four counties on Long Island. We want
to project the facility locations into the metric WGS 84 coordinate
system so that we can overlay facility locations on our census block
data.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">LIFacilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RSEISearch.html">RSEISearch</a></span><span class="op">(</span>DownloadRSEI<span class="op">=</span> <span class="cn">FALSE</span>,RSEIpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"RSEI_Public_Release_Data_V2311_RY2021"</span>,sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span>, RSEIversion<span class="op">=</span><span class="st">"v2311"</span>, StartYr<span class="op">=</span><span class="fl">2017</span>, EndYr<span class="op">=</span><span class="fl">2021</span>, State <span class="op">=</span> <span class="st">"NY"</span>, County <span class="op">=</span> <span class="va">LICounties</span>, returnLocation <span class="op">=</span> <span class="cn">T</span>, projectTo <span class="op">=</span> <span class="fl">3857</span>, wider<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>We can save the 2 objects in the list as dataframes. The first
contains all the data, including emissions data and hazard scores, while
the second contains only locational data. We can also check the
coordinate system</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LIFacilitiesEmissions</span> <span class="op">&lt;-</span> <span class="va">LIFacilities</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">LIFacilitiesEmissions</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LI_Facility_locations</span> <span class="op">&lt;-</span> <span class="va">LIFacilities</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">LI_Facility_locations</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">LI_Facility_locations</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="facility-or-chem-searches">Facility or Chem searches<a class="anchor" aria-label="anchor" href="#facility-or-chem-searches"></a>
</h2>
<p>In the above example we are looking for any TRI Facilities on Long
Island, but we could also refine our search by facility name or
location, industry, or by chemical. There are two functions,
FacilitySearch and ChemSearch, that the RSEISearch function relies on to
filter the Facility and Chemical tables. These functions can be used
directly to narrow in on particular information stored in those
files.</p>
<p>Say we are interested in the locations of facilities that store crude
petroleum in bult (NAICS code 424710). We read in the Facility table,
and run the FacilitySearch function to find facilities with that NAICS
code.17 different facilities are returned.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LIPetroFacilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/FacilitySearch.html">FacilitySearch</a></span><span class="op">(</span><span class="va">Facility</span>, NAICS<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">424710</span><span class="op">)</span>,  statesearch <span class="op">=</span> <span class="st">"NY"</span>, countysearch <span class="op">=</span> <span class="va">LICounties</span>, AbbrevOutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">LIPetroFacilities</span><span class="op">)</span></span></code></pre></div>
<p>We could also look for facilities that release lead. To do this we
could first use the ChemicalSearch function to look up how lead is
categorized in the RSEI emmissions data. The ChemSearch function will
match whole or partial chemical names, and capitalization does not
matter. Any row that includes the search term in the name will be
returned.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Lead</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ChemSearch.html">ChemSearch</a></span><span class="op">(</span><span class="va">Chems</span>,chemnamesearch <span class="op">=</span> <span class="st">"lead"</span>, AbbrevOutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">Lead</span><span class="op">)</span></span></code></pre></div>
<p>We see that there are two ways that lead can be reported, as lead or
lead compounds, each with a different Chemical Number in the RSEI
database. So if we want to see the locations and total emissions/hazard
scores of facilities that have released lead in the last 5 years, we
could pass the RSEISearch function either a vector of the Chemical
Numbers 346 and 347, or we could just include the search term “lead” in
the argument ChemicalNames.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LIleadSearch_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RSEISearch.html">RSEISearch</a></span><span class="op">(</span>DownloadRSEI<span class="op">=</span> <span class="cn">FALSE</span>, RSEIpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"RSEI_Public_Release_Data_V2311_RY2021"</span>,sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span>, RSEIversion<span class="op">=</span><span class="st">"v2311"</span>, StartYr<span class="op">=</span><span class="fl">2017</span>, EndYr<span class="op">=</span><span class="fl">2021</span>, State <span class="op">=</span> <span class="st">"NY"</span>, County <span class="op">=</span> <span class="va">LICounties</span>, rsei_Chem_Numbers  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">346</span>,<span class="fl">347</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">LIleadSearch_1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculating-community-characteristics-via-areal-apportionment-method">Calculating Community Characteristics via Areal Apportionment
Method<a class="anchor" aria-label="anchor" href="#calculating-community-characteristics-via-areal-apportionment-method"></a>
</h2>
<p>We want to overlay the facility emissions data on the block group
level demographic data and determine the make up of communities within
1km, 5km, and 10km of a TRI reporting facility. We want to compare those
communities with the county as a whole to determine if communities near
TRI facilities are more likely to be non-white or have a lower median
income. To do this we can use the CensusBuffer function. We provide a
vector of radii for our buffers in meters, the object with projected
block group data, and the RSEI facility location information, which is a
spatial dataframe (sf object) that contains the facility locations
projected to the WGS 84 coordinate system. We are setting runTract to
false but runCounty to true because we would like to compare
demographics to the total estimates for each of the 4 LI counties, and
we provide the projected county ACS data. We also need to provide the
vector of ACS variables with their names. Finally, we have the option to
provide the rsei emissions dataframe. If this is included, these data
are merged into the final output so that each row is a chemical-facility
combination, and the columns include the summed emissions and associated
scores as well as the demography in each buffer. If this is not
provided, the output of this function is a wide format dataframe with a
row for each facility and in the columns the tabulated ACS variables
within each buffer distance of that facility location. If runTract or
runCounty are true, it also includes the county or tract totals for each
variable for comparison.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">FinalLIDemos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CensusBuffer.html">CensusBuffer</a></span><span class="op">(</span>buffer_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="fl">5000</span>,<span class="fl">10000</span><span class="op">)</span>, census_dat_proj<span class="op">=</span> <span class="va">CensusLI_bg</span>, FacilityLocation_m <span class="op">=</span> <span class="va">LI_Facility_locations</span>, runTract <span class="op">=</span> <span class="cn">FALSE</span>, tract_dat_proj <span class="op">=</span> <span class="cn">NULL</span>, runCounty <span class="op">=</span> <span class="cn">TRUE</span>, county_dat_proj <span class="op">=</span> <span class="va">Census_county_NY</span>, variableNames <span class="op">=</span> <span class="va">my_vars</span>, EmissionData <span class="op">=</span> <span class="va">LIFacilitiesEmissions</span><span class="op">)</span></span></code></pre></div>
<p>The output of this final function is a large table that contains a
ton of information, including:</p>
<ul>
<li>Information about the chemical released, including the name, total
emmissions per year, and associated RSEI scores</li>
<li>Information about the facility that released the chemical, including
the name, location, and TRIFID number.</li>
<li>Information about the demographic composition near the facility (in
this case, within 1, 5, and 10km). We tracked the population of
different races as well as the median income, but this will vary
depending on the census variables tracked.</li>
<li>Information about the demographic make up of the census tract and
county where each facility is located, for comparative purposes.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">FinalLIDemos</span>, rownames<span class="op">=</span><span class="cn">FALSE</span>, filter<span class="op">=</span><span class="st">"top"</span>, class <span class="op">=</span> <span class="st">'cell-border stripe'</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sarah Valencia, Environmental Defense Fund.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
